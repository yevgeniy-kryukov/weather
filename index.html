<!DOCTYPE html>
<html lang="ru">
<head>
  <title>My Weather Helper</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
</head>
<body>

<div class="container">
	<h1>My Weather Helper</h1>
	<div><label for="autocomplete">Введите и укажите город: </label><input id="autocomplete"></div><br>
	<div id="titulAccuWeather">Прогноз погоды на 5 дней от сервиса AccuWeather</div><br>
	<div id="resultAccuWeather"></div>
 </div>
 
 <script src="//code.jquery.com/jquery-1.12.4.js"></script>
 <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
 <script>
	$(document).ready(function() {
	
		function displayDate(sec) {
			var curdate = new Date(null);
			curdate.setTime(sec * 1000);
			return curdate.toLocaleDateString();
		}
	
		$("#titulAccuWeather").hide();
		
		$( "#autocomplete" ).autocomplete({
			source: function( request, response ) {
					$.get(
						'accu/helper_search_city.php', 
						{ q: request.term }, 
						function(data) { 
							var data_filter = [];
							for(var i = 0; i < data.length; i++) {
								data_filter[i] = {label: data[i].LocalizedName, value: data[i].Key};
							}
							response(data_filter); 
						}, 
						'json'
					);
				}
		});
		
		$( "#autocomplete" ).on( "autocompleteselect", 
			function( event, ui ) {
				$.get(
					'accu/helper.php',
					{ codecity: ui.item.value },
					function(data) {
						$("#titulAccuWeather").show();
						$("#resultAccuWeather").html('');
						for(var i = 0; i < data.DailyForecasts.length; i++) {
							$("#resultAccuWeather").html(
											$("#resultAccuWeather").html()
											+ '<div>' 
											+ displayDate(data.DailyForecasts[i].EpochDate) 
											+ ': ' + data.DailyForecasts[i].Temperature.Maximum.Value 
											+ ' ' + data.DailyForecasts[i].Temperature.Maximum.Unit 
											+ '</div>'
										);
						}
					},
					'json'
				);		
				$( "#autocomplete" ).val(ui.item.label);
				return false;				
			} 
		);


		
	});
</script>
</body>
</html>